<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>T·∫£i h√†ng lo·∫°t - C·ªïng d·ªãch v·ª• c√¥ng</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 28px;
        margin-bottom: 10px;
      }

      .header p {
        opacity: 0.9;
        font-size: 14px;
      }

      .content {
        padding: 30px;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 25px;
        border-bottom: 2px solid #e0e0e0;
      }

      .tab {
        padding: 12px 24px;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        cursor: pointer;
        font-size: 15px;
        font-weight: 600;
        color: #666;
        transition: all 0.3s;
      }

      .tab:hover {
        color: #667eea;
      }

      .tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      /* Guide Styles */
      .guide-section {
        margin-bottom: 30px;
      }

      .guide-title {
        font-size: 24px;
        font-weight: 700;
        color: #333;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .step {
        background: #f8f9fa;
        border-left: 4px solid #667eea;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 8px;
      }

      .step-number {
        display: inline-block;
        width: 32px;
        height: 32px;
        background: #667eea;
        color: white;
        border-radius: 50%;
        text-align: center;
        line-height: 32px;
        font-weight: 700;
        margin-right: 10px;
      }

      .step-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 12px;
      }

      .step-content {
        color: #555;
        line-height: 1.8;
        margin-left: 42px;
      }

      .step-content ul {
        margin: 10px 0;
        padding-left: 20px;
      }

      .step-content li {
        margin: 8px 0;
      }

      .step-image {
        margin: 15px 0;
        padding: 15px;
        background: white;
        border-radius: 8px;
        border: 2px solid #e0e0e0;
      }

      .step-image img {
        max-width: 100%;
        border-radius: 4px;
      }

      .code-inline {
        background: #e3f2fd;
        padding: 2px 8px;
        border-radius: 4px;
        font-family: "Consolas", monospace;
        font-size: 13px;
        color: #1565c0;
        font-weight: 600;
      }

      .highlight {
        background: #fff3cd;
        padding: 2px 6px;
        border-radius: 3px;
        font-weight: 600;
      }

      .tip-box {
        background: #e8f5e9;
        border-left: 4px solid #4caf50;
        padding: 15px;
        margin: 15px 0;
        border-radius: 6px;
      }

      .tip-box strong {
        color: #2e7d32;
      }

      .warning-box {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        margin: 15px 0;
        border-radius: 6px;
      }

      .warning-box strong {
        color: #856404;
      }

      .keyboard-key {
        display: inline-block;
        padding: 4px 10px;
        background: #333;
        color: white;
        border-radius: 4px;
        font-family: "Consolas", monospace;
        font-size: 13px;
        font-weight: 600;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      /* Tool Styles */
      .input-section {
        margin-bottom: 20px;
      }

      .input-section label {
        display: block;
        font-weight: 600;
        margin-bottom: 10px;
        color: #333;
        font-size: 15px;
      }

      textarea {
        width: 100%;
        min-height: 250px;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-family: "Consolas", monospace;
        font-size: 13px;
        resize: vertical;
        transition: border-color 0.3s;
      }

      textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .hint {
        margin-top: 8px;
        font-size: 13px;
        color: #666;
      }

      .button-group {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
      }

      button {
        padding: 14px 28px;
        border: none;
        border-radius: 10px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        flex: 1;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      }

      .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .btn-secondary {
        background: #f5f5f5;
        color: #333;
      }

      .btn-secondary:hover {
        background: #e0e0e0;
      }

      .progress-section {
        display: none;
        margin-bottom: 30px;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: white;
        padding: 18px;
        border-radius: 10px;
        text-align: center;
        border: 2px solid #e0e0e0;
      }

      .stat-number {
        font-size: 32px;
        font-weight: 700;
        color: #667eea;
      }

      .stat-label {
        font-size: 13px;
        color: #666;
        margin-top: 5px;
      }

      .progress-bar {
        width: 100%;
        height: 32px;
        background: #f0f0f0;
        border-radius: 16px;
        overflow: hidden;
        position: relative;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        transition: width 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 13px;
        font-weight: 700;
      }

      .progress-text {
        margin-top: 10px;
        text-align: center;
        color: #666;
        font-size: 14px;
      }

      .log-section {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        max-height: 500px;
        overflow-y: auto;
      }

      .log-item {
        padding: 12px;
        margin-bottom: 8px;
        border-radius: 6px;
        font-size: 14px;
        display: flex;
        align-items: flex-start;
        gap: 10px;
        line-height: 1.5;
      }

      .log-success {
        background: #d4edda;
        color: #155724;
      }

      .log-error {
        background: #f8d7da;
        color: #721c24;
      }

      .log-info {
        background: #d1ecf1;
        color: #0c5460;
      }

      .log-icon {
        font-weight: 700;
        font-size: 16px;
        flex-shrink: 0;
      }

      .download-link {
        color: #667eea;
        text-decoration: none;
        font-weight: 600;
      }

      .download-link:hover {
        text-decoration: underline;
      }

      .screenshot-placeholder {
        background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
        padding: 40px;
        text-align: center;
        border-radius: 8px;
        color: #666;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üöÄ C√¥ng c·ª• t·∫£i h√†ng lo·∫°t</h1>
        <p>C·ªïng th√¥ng tin ƒëi·ªán t·ª≠ Ch√≠nh ph·ªß - thutuc.dichvucong.gov.vn</p>
      </div>

      <div class="content">
        <div class="tabs">
          <button class="tab active" onclick="switchTab('guide')">
            üìñ H∆∞·ªõng d·∫´n
          </button>
          <button class="tab" onclick="switchTab('tool')">
            üõ†Ô∏è C√¥ng c·ª• t·∫£i
          </button>
        </div>

        <!-- Tab Guide -->
        <div id="guideTab" class="tab-content active">
          <div class="guide-section">
            <div class="guide-title">
              üìñ H∆∞·ªõng d·∫´n chi ti·∫øt: L·∫•y JSON t·ª´ API
            </div>

            <div class="step">
              <div class="step-title">
                <span class="step-number">1</span>
                M·ªü trang thutuc.dichvucong.gov.vn
              </div>
              <div class="step-content">
                <p>
                  Truy c·∫≠p:
                  <code class="code-inline"
                    >https://thutuc.dichvucong.gov.vn</code
                  >
                </p>
                <p>
                  T√¨m ki·∫øm ho·∫∑c l·ªçc danh s√°ch th·ªß t·ª•c h√†nh ch√≠nh m√† b·∫°n mu·ªën
                  t·∫£i.
                </p>
              </div>
            </div>

            <div class="step">
              <div class="step-title">
                <span class="step-number">2</span>
                M·ªü Developer Tools (F12)
              </div>
              <div class="step-content">
                <p>Nh·∫•n ph√≠m <span class="keyboard-key">F12</span> ho·∫∑c:</p>
                <ul>
                  <li>
                    Windows/Linux: <span class="keyboard-key">Ctrl</span> +
                    <span class="keyboard-key">Shift</span> +
                    <span class="keyboard-key">I</span>
                  </li>
                  <li>
                    Mac: <span class="keyboard-key">Cmd</span> +
                    <span class="keyboard-key">Option</span> +
                    <span class="keyboard-key">I</span>
                  </li>
                  <li>
                    Ho·∫∑c chu·ªôt ph·∫£i ‚Üí ch·ªçn
                    <span class="highlight">"Inspect"</span> /
                    <span class="highlight">"Ki·ªÉm tra"</span>
                  </li>
                </ul>
              </div>
            </div>

            <div class="step">
              <div class="step-title">
                <span class="step-number">3</span>
                Chuy·ªÉn sang tab Network
              </div>
              <div class="step-content">
                <p>
                  Trong Developer Tools, t√¨m v√† nh·∫•n v√†o tab
                  <span class="highlight">"Network"</span> /
                  <span class="highlight">"M·∫°ng"</span>
                </p>
                <div class="tip-box">
                  <strong>üí° M·∫πo:</strong> N·∫øu kh√¥ng th·∫•y tab Network, c√≥ th·ªÉ n√≥
                  b·ªã ·∫©n. Nh·∫•n v√†o d·∫•u
                  <code class="code-inline">&gt;&gt;</code> ƒë·ªÉ xem th√™m c√°c tab.
                </div>
                <div class="step-image">
                  <div class="screenshot-placeholder">
                    <img src="./sc1.png" style="background-size: contain" />
                  </div>
                </div>
              </div>
            </div>

            <div class="step">
              <div class="step-title">
                <span class="step-number">4</span>
                L√†m m·ªõi trang ho·∫∑c th·ª±c hi·ªán t√¨m ki·∫øm
              </div>
              <div class="step-content">
                <p>ƒê·ªÉ b·∫Øt ƒë∆∞·ª£c c√°c request API:</p>
                <ul>
                  <li>
                    Nh·∫•n <span class="keyboard-key">F5</span> ƒë·ªÉ reload trang,
                    HO·∫∂C
                  </li>
                  <li>Th·ª±c hi·ªán t√¨m ki·∫øm/l·ªçc danh s√°ch th·ªß t·ª•c h√†nh ch√≠nh</li>
                </ul>
                <p>B·∫°n s·∫Ω th·∫•y nhi·ªÅu request xu·∫•t hi·ªán trong tab Network.</p>
              </div>
            </div>

            <div class="step">
              <div class="step-title">
                <span class="step-number">5</span>
                Chuy·ªÉn sang tab Response
              </div>
              <div class="step-content">
                <p>
                  Nh·∫•n v√†o tab <span class="highlight">"Response"</span> ƒë·ªÉ xem
                  d·ªØ li·ªáu JSON tr·∫£ v·ªÅ.
                </p>
                <div class="warning-box">
                  <strong>‚ö†Ô∏è Ki·ªÉm tra:</strong> ƒê·∫£m b·∫£o response ch·ª©a c√°c
                  tr∆∞·ªùng: <code class="code-inline">ID</code>,
                  <code class="code-inline">PROCEDURE_CODE</code>,
                  <code class="code-inline">PROCEDURE_NAME</code>
                </div>
                <div class="step-image">
                  <div class="screenshot-placeholder">
                    <img src="./sc2.png" style="background-size: contain" />
                  </div>
                </div>
              </div>
            </div>

            <div class="step">
              <div class="step-title">
                <span class="step-number">6</span>
                Copy JSON data
              </div>
              <div class="step-content">
                <p><strong>C√°ch 1:</strong> Copy tr·ª±c ti·∫øp t·ª´ tab Response</p>
                <ul>
                  <li>Chu·ªôt ph·∫£i v√†o v√πng JSON</li>
                  <li>
                    Ch·ªçn <span class="highlight">"Copy"</span> ho·∫∑c
                    <span class="highlight">"Copy value"</span>
                  </li>
                </ul>

                <p style="margin-top: 15px">
                  <strong>C√°ch 2:</strong> S·ª≠ d·ª•ng Console
                </p>
                <ul>
                  <li>
                    Chu·ªôt ph·∫£i v√†o request ‚Üí ch·ªçn
                    <span class="highlight">"Copy"</span> ‚Üí
                    <span class="highlight">"Copy response"</span>
                  </li>
                </ul>

                <div class="tip-box">
                  <strong>üí° Ki·ªÉm tra:</strong> Paste v√†o Notepad ƒë·ªÉ ƒë·∫£m b·∫£o
                  JSON h·ª£p l·ªá. N√≥ ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng
                  <code class="code-inline">[</code> v√† k·∫øt th√∫c b·∫±ng
                  <code class="code-inline">]</code>
                </div>
              </div>
            </div>

            <div class="step">
              <div class="step-title">
                <span class="step-number">7</span>
                Paste JSON v√†o c√¥ng c·ª• t·∫£i
              </div>
              <div class="step-content">
                <p>
                  Chuy·ªÉn sang tab
                  <span class="highlight">"üõ†Ô∏è C√¥ng c·ª• t·∫£i"</span> trong trang
                  n√†y.
                </p>
                <p>
                  Paste JSON v√†o √¥ textarea v√† nh·∫•n
                  <span class="highlight">"B·∫Øt ƒë·∫ßu t·∫£i t·ª´ JSON"</span>
                </p>
                <div class="tip-box">
                  <strong>‚ú® Ho√†n t·∫•t!</strong> Tool s·∫Ω t·ª± ƒë·ªông t·∫£i t·∫•t c·∫£ c√°c
                  file Word xu·ªëng m√°y b·∫°n.
                </div>
              </div>
            </div>
          </div>

          <div class="warning-box" style="margin-top: 30px">
            <p><strong>üîç Kh√¥ng t√¨m th·∫•y request API?</strong></p>
            <p>‚Ä¢ Th·ª≠ reload trang v·ªõi Network ƒëang m·ªü</p>
            <p>‚Ä¢ Th·ª≠ t√¨m ki·∫øm ho·∫∑c l·ªçc d·ªØ li·ªáu tr√™n trang web</p>
            <p>
              ‚Ä¢ T√¨m request c√≥ t√™n nh∆∞: <code class="code-inline">search</code>,
              <code class="code-inline">list</code>,
              <code class="code-inline">getTTHC</code>,
              <code class="code-inline">getProcedure</code>
            </p>
          </div>
        </div>

        <!-- Tab Tool -->
        <div id="toolTab" class="tab-content">
          <div class="warning-box">
            <p><strong>‚ö†Ô∏è L∆∞u √Ω quan tr·ªçng:</strong></p>
            <p>
              ‚Ä¢ Tr√¨nh duy·ªát s·∫Ω h·ªèi cho ph√©p t·∫£i nhi·ªÅu file - h√£y ch·ªçn
              <strong>"Cho ph√©p"</strong>
            </p>
            <p>‚Ä¢ ƒê·ª£i kho·∫£ng 2 gi√¢y gi·ªØa m·ªói l·∫ßn t·∫£i ƒë·ªÉ tr√°nh b·ªã ch·∫∑n</p>
            <p>‚Ä¢ Kh√¥ng ƒë√≥ng ho·∫∑c refresh trang trong khi ƒëang t·∫£i</p>
          </div>

          <div class="input-section">
            <label for="jsonInput">Paste JSON data t·ª´ API:</label>
            <textarea
              id="jsonInput"
              placeholder='[
  {
    "ID": "418834",
    "PROCEDURE_CODE": "1.014421",
    "PROCEDURE_NAME": "T√™n th·ªß t·ª•c h√†nh ch√≠nh...",
    ...
  },
  {
    "ID": "418833",
    "PROCEDURE_CODE": "1.014419",
    ...
  }
]'
            ></textarea>
            <div class="hint">
              üí° Paste to√†n b·ªô JSON array t·ª´ tab Response trong Network
            </div>
          </div>

          <div class="button-group">
            <button class="btn-primary" id="startBtn" onclick="startDownload()">
              <span>‚¨áÔ∏è</span> B·∫Øt ƒë·∫ßu t·∫£i t·ª´ JSON
            </button>
            <button class="btn-secondary" onclick="clearAll()">üóëÔ∏è X√≥a</button>
          </div>

          <div class="progress-section" id="progressSection">
            <div class="stats">
              <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">T·ªïng s·ªë</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="successCount">0</div>
                <div class="stat-label">Th√†nh c√¥ng</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="errorCount">0</div>
                <div class="stat-label">L·ªói</div>
              </div>
            </div>

            <div class="progress-bar">
              <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div class="progress-text" id="progressText">ƒêang chu·∫©n b·ªã...</div>
          </div>

          <div class="log-section" id="logSection"></div>
        </div>
      </div>
    </div>

    <script>
      let currentIndex = 0;
      let items = [];
      let successCount = 0;
      let errorCount = 0;

      function switchTab(tabName) {
        document
          .querySelectorAll(".tab")
          .forEach((t) => t.classList.remove("active"));
        document
          .querySelectorAll(".tab-content")
          .forEach((t) => t.classList.remove("active"));

        if (tabName === "guide") {
          document.querySelectorAll(".tab")[0].classList.add("active");
          document.getElementById("guideTab").classList.add("active");
        } else {
          document.querySelectorAll(".tab")[1].classList.add("active");
          document.getElementById("toolTab").classList.add("active");
        }
      }

      function addLog(message, type = "info") {
        const logSection = document.getElementById("logSection");
        const logItem = document.createElement("div");
        logItem.className = `log-item log-${type}`;

        const icons = {
          success: "‚úì",
          error: "‚úó",
          info: "‚Ñπ",
        };

        logItem.innerHTML = `
                <span class="log-icon">${icons[type]}</span>
                <span>${message}</span>
            `;

        logSection.insertBefore(logItem, logSection.firstChild);
      }

      function updateProgress() {
        const progress = Math.round((currentIndex / items.length) * 100);
        document.getElementById("progressFill").style.width = progress + "%";
        document.getElementById("progressFill").textContent = progress + "%";
        document.getElementById(
          "progressText"
        ).textContent = `ƒê√£ x·ª≠ l√Ω ${currentIndex}/${items.length} vƒÉn b·∫£n`;

        document.getElementById("totalCount").textContent = items.length;
        document.getElementById("successCount").textContent = successCount;
        document.getElementById("errorCount").textContent = errorCount;
      }

      function normalizeCode(code) {
        return code.replace(/\./g, "");
      }

      async function downloadNext() {
        if (currentIndex >= items.length) {
          addLog("üéâ Ho√†n th√†nh! ƒê√£ t·∫£i xong t·∫•t c·∫£ vƒÉn b·∫£n.", "success");
          document.getElementById("startBtn").disabled = false;
          document.getElementById("startBtn").innerHTML =
            "<span>‚¨áÔ∏è</span> B·∫Øt ƒë·∫ßu t·∫£i t·ª´ JSON";
          return;
        }

        const item = items[currentIndex];
        const code = item.code;
        const id = item.id;
        const name = item.name || "";

        try {
          const normalizedCode = normalizeCode(code);
          const downloadUrl = `https://thutuc.dichvucong.gov.vn/jsp/tthc/export/export_word_detail_tthc.jsp?maTTHC=${normalizedCode}&idTTHC=${id}`;

          addLog(`ƒêang t·∫£i: <strong>${code}</strong> - ${name}`, "info");

          // T·∫°o th·∫ª <a> ·∫©n ƒë·ªÉ t·∫£i file tr·ª±c ti·∫øp
          const a = document.createElement("a");
          a.href = downloadUrl;
          a.download = `TTHC_${normalizedCode}.doc`;
          a.style.display = "none";
          document.body.appendChild(a);
          a.click();

          // X√≥a th·∫ª <a> sau khi click
          setTimeout(() => {
            document.body.removeChild(a);
          }, 100);

          successCount++;
          const linkHtml = `<a href="${downloadUrl}" class="download-link" target="_blank">T·∫£i l·∫°i</a>`;
          addLog(
            `‚úì <strong>${code}</strong> - ${name} | ${linkHtml}`,
            "success"
          );
        } catch (error) {
          errorCount++;
          addLog(
            `‚úó L·ªói khi t·∫£i vƒÉn b·∫£n <strong>${code}</strong>: ${error.message}`,
            "error"
          );
        }

        currentIndex++;
        updateProgress();

        // ƒê·ª£i 2 gi√¢y tr∆∞·ªõc khi t·∫£i vƒÉn b·∫£n ti·∫øp theo
        setTimeout(downloadNext, 2000);
      }

      function startDownload() {
        const input = document.getElementById("jsonInput").value.trim();

        if (!input) {
          alert("Vui l√≤ng paste JSON data!");
          return;
        }

        try {
          const jsonData = JSON.parse(input);

          if (!Array.isArray(jsonData) || jsonData.length === 0) {
            alert("JSON ph·∫£i l√† m·ªôt array v√† kh√¥ng ƒë∆∞·ª£c r·ªóng!");
            return;
          }

          // Parse JSON v√† l·∫•y th√¥ng tin
          items = jsonData.map((item) => ({
            code: item.PROCEDURE_CODE,
            id: item.ID,
            name: item.PROCEDURE_NAME || "",
          }));

          // Reset
          currentIndex = 0;
          successCount = 0;
          errorCount = 0;
          document.getElementById("logSection").innerHTML = "";

          // Hi·ªÉn th·ªã progress
          document.getElementById("progressSection").style.display = "block";
          document.getElementById("startBtn").disabled = true;
          document.getElementById("startBtn").innerHTML =
            "<span>‚è≥</span> ƒêang t·∫£i...";

          addLog(`üöÄ B·∫Øt ƒë·∫ßu t·∫£i ${items.length} vƒÉn b·∫£n...`, "info");
          addLog(
            `‚ö†Ô∏è L∆∞u √Ω: Tr√¨nh duy·ªát c√≥ th·ªÉ h·ªèi cho ph√©p t·∫£i nhi·ªÅu file. H√£y ch·ªçn "Cho ph√©p" ƒë·ªÉ t·∫£i t·ª± ƒë·ªông.`,
            "info"
          );
          updateProgress();

          // B·∫Øt ƒë·∫ßu t·∫£i
          downloadNext();
        } catch (error) {
          alert(
            "JSON kh√¥ng h·ª£p l·ªá! Vui l√≤ng ki·ªÉm tra l·∫°i.\n\nL·ªói: " + error.message
          );
        }
      }

      function clearAll() {
        document.getElementById("jsonInput").value = "";
        document.getElementById("logSection").innerHTML = "";
        document.getElementById("progressSection").style.display = "none";
        currentIndex = 0;
        successCount = 0;
        errorCount = 0;
        items = [];
      }
    </script>
  </body>
</html>
